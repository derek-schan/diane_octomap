<launch>
   
	<arg name="manager" default="diane_manager"/>
	<arg name="namespace" default="r"/>

	<!--<node ns="$(arg namespace)" pkg="nodelet" type="nodelet" name="$(arg manager)" args="manager"/>-->

	<node pkg="tf" type="static_transform_publisher" name="simple_tf_diane_octomap_broadcaster_node" args="0 0 0 0 0 0 my_frame map 100" />


	<node ns="$(arg namespace)" pkg="nodelet" type="nodelet" name="diane_octomap" args="load diane_octomap/DianeOctomapNodelet $(arg manager)">


	<!--Octomap's Parameters-->
		<param name="otFileName" type="str" value="/home/diane/catkin_ws/src/diane_octomap/files/MapFiles/Octree/Utilizados/Kinect/Funcionais/Escada_video_objetos_5_final.ot" />

		<!--<param name="otFileName" type="str" value="/home/derekchan/catkin_workspace/src/diane_octomap/files/MapFiles/Octree/Escada_Laser_5.ot" />-->
		<!--<param name="otFileName" type="str" value="/home/derekchan/catkin_workspace/src/diane_octomap/files/MapFiles/Octree/Utilizados/Laser/Funcionais/Escada_Laser_5_Ajustada.ot" />-->
		<!--<param name="otFileName" type="str" value="/home/derekchan/catkin_workspace/src/diane_octomap/files/MapFiles/Octree/Laser/Escada_Principal_Laser_5.ot" />-->


		<!--<param name="otFileName" type="str" value="/home/derekchan/catkin_workspace/src/diane_octomap/files/MapFiles/Octree/Utilizados/Laser/Funcionais/Escada_Laser_Horizontal_5.ot" />-->


	<!--BoundingBox's Parameters-->
		<!-- Kinect - The MinPointZ value is 0.20 because the ground is 20 cm above the 0 level. -->

		
		<param name="BoundingBoxMinPointX" type="double" value="-5" />
		<param name="BoundingBoxMinPointY" type="double" value="-5" />
		<param name="BoundingBoxMinPointZ" type="double" value="0" />

		<param name="BoundingBoxMaxPointX" type="double" value="5" />
		<param name="BoundingBoxMaxPointY" type="double" value="100" />
		<param name="BoundingBoxMaxPointZ" type="double" value="100" />
		


		<!-- Laser - The MaxPointZ value is 2.8 to remove the ceiling. The ceiling makes the algorithm not detect any stairs. -->

		<!--
		<param name="BoundingBoxMinPointX" type="double" value="-5" />
		<param name="BoundingBoxMinPointY" type="double" value="-5" />
		<param name="BoundingBoxMinPointZ" type="double" value="0" />

		<param name="BoundingBoxMaxPointX" type="double" value="5" />
		<param name="BoundingBoxMaxPointY" type="double" value="100" />
		<param name="BoundingBoxMaxPointZ" type="double" value="2.8" />
		-->


	<!--Octomap's Parameters-->
		<param name="ColumnMinSize" type="int" value="3" />
		<param name="ColumnMaxSize" type="int" value="6" />


	<!--Hough Transform's Parameters-->
		<param name="Rho_Passo" type="double" value="0.05" />
		<param name="Theta_Passo" type="double" value="5" />

		<param name="AccumulateDistTolerance" type="double" value="0.025" />
		<param name="MinAmountVotes" type="int" value="10" />


	<!--Grouped Line's by (Rho, Theta) Parameters-->
		<param name="MinNumberLines" type="int" value="3" />
		<param name="MaxNumberLines" type="int" value="6" />


	<!--Segmentation's Parameters-->
		<param name="SegmentationXTol" type="double" value="0.50" />


	<!--Grouped Line's by (Theta, X-Interval) Parameters-->
		<param name="IntervalXTol" type="double" value="0.50" />


	<!--Filtering Grouped Line's by quantity of Line Parameters-->
		<param name="MinNumSteps" type="int" value="3" />


	<!--Merge Group's Lines by (Rho) Parameters-->
		<param name="MergeDeltaRhoTol" type="double" value="0.11" />


	<!--Sequence Filter's Parameters-->
		<param name="SequenceZMax" type="double" value="0.30" />
		<param name="SequenceMinStepWidth" type="double" value="0.23" />
		<param name="SequenceMaxStepWidth" type="double" value="0.38" />


	<!--Stair Modelling's Parameters-->
		<param name="ModellingMinStepHeight" type="double" value="0" />
		<param name="ModellingMaxStepHeight" type="double" value="0.23" />
		<param name="ModellingMinStepWidth" type="double" value="0.24" />
		<param name="ModellingMaxStepWidth" type="double" value="0.36" />

	</node>




	<!--LASER-->

<!--
	<node pkg="tf" type="static_transform_publisher" name="simple_tf_laser_broadcaster_node" args="0 0.5 0 0 1.6 1.6 velodyne map 100" />	
-->	

<!--	
	<node pkg="velodyne_driver" type="velodyne_node" name="velodyne_node" >
		<param name="model" type="string" value="VLP16" />
	</node>
-->
<!--
	<node pkg="velodyne_pointcloud" type="cloud_node" name="cloud_node" >
		<param name="calibration" type="string" value="$(find velodyne_pointcloud)/params/VLP16db.yaml" /> 
-->
		<!--<param name="min_range" type="double" value="0.01" />-->
<!--
	</node>
-->

	<!--KINECT - Iniciando os nós do KINECT referentes a depth e iniciando o nó da funcão de transferência do Kinect para o mapa estático-->


	<include file="/opt/ros/indigo/share/freenect_launch/launch/freenect.launch">
		<arg name="rgb_processing"                  value="false" />
		<arg name="ir_processing"                   value="false" />
		<arg name="depth_registered_processing"     value="false" />
		<arg name="disparity_processing"            value="false" />
		<arg name="disparity_registered_processing" value="false" />
	</include>

	<node pkg="tf" type="static_transform_publisher" name="simple_tf_kinect_broadcaster_node" args="0 0.30 0 0 0 1.57079632679 camera_depth_optical_frame map 100" /> 



	<!--RELAY - Nó responsável por republicar os dados de pointcloud do Velodyne no tópico de pointcloud do Kinect-->
		<!--Este passo foi adicionado porque se utilizarmos dois remaps para o octomap_server (um do velodyne para o cloud_in e outro do kynect para o cloud_in) eles se sobreescreviam-->
<!--
	<node pkg="topic_tools" type="relay" name="relay_velodyne_to_kinect_" args="/Diane_Octomap/velodyne_points /Diane_Octomap/camera/depth/points">
		<param name="unreliable" type="bool" value="false" />
		<param name="lazy" type="bool" value="true" />
	</node>
-->

	<!--OCTOMAP SERVER-->

	<node pkg="octomap_server" type="octomap_server_node" name="octomap_server_node" output='screen'>
		<param name="frame_id" type="string" value="/map" />
		<param name="resolution" value="0.05" />
		<param name="height_map" type="bool" value="true" />
		<param name="sensor_model/max_range" value="-1" />
		<param name="latch" type="bool"  value="false" />
		<param name="sensor_model/max_range" value="100.0" />
		<param name="height_map" value="false" />
		<param name="color/r" value="0.62" />
		<param name="color/g" value="0.66" />
		<param name="color/b" value="0.85" />
		<param name="color/a" value="1" />
			
		<remap from="cloud_in" to="/camera/depth/points" />

		<!--Este segundo remap está sobreescrevendo o 1o. Por esse motivo, utilizamos o relay-->
		<!--<remap from="cloud_in" to="/velodyne_points" />-->

	</node>

</launch>
